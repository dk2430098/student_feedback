<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - NITMN Feedback</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>

<body class="bg-slate-50 h-screen flex flex-col text-slate-900">

    <!-- Navbar -->
    <nav
        class="bg-indigo-900 text-white shadow-lg z-20 sticky top-0 backdrop-blur-md bg-opacity-95 supports-[backdrop-filter]:bg-opacity-80">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <!-- Branding -->
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                        <img src="../assets/images/nitmn_logo.jpg" alt="Logo" class="h-8 w-auto">
                    </div>
                    <div>
                        <h1 class="text-xl font-bold tracking-tight">System Admin</h1>
                        <p class="text-xs text-indigo-200 hidden md:block">National Institute of Technology Manipur</p>
                    </div>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-1 bg-indigo-800 p-1 rounded-lg">
                    <button onclick="switchTab('complaints')" id="tab-complaints"
                        class="px-4 py-1.5 rounded-md text-sm font-bold bg-white text-indigo-900 shadow transition">Complaints</button>
                    <button onclick="switchTab('users')" id="tab-users"
                        class="px-4 py-1.5 rounded-md text-sm font-bold text-indigo-300 hover:text-white transition">Staff
                        Management</button>
                </div>

                <div class="hidden md:flex items-center space-x-4">
                    <button onclick="logout()"
                        class="text-red-300 font-medium px-3 py-2 hover:bg-indigo-800 rounded-lg transition hover:text-white">Logout
                        ‚ûî</button>
                </div>

                <!-- Mobile Hamburger -->
                <div class="md:hidden">
                    <button id="admin-menu-btn" class="text-white hover:text-indigo-200 focus:outline-none">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu Dropdown -->
            <div id="admin-mobile-menu" class="hidden md:hidden pb-4">
                <div class="flex flex-col space-y-2">
                    <button onclick="switchTab('complaints'); toggleAdminMenu()"
                        class="text-left px-4 py-2 hover:bg-indigo-800 rounded">Complaints</button>
                    <button onclick="switchTab('users'); toggleAdminMenu()"
                        class="text-left px-4 py-2 hover:bg-indigo-800 rounded">Staff Management</button>
                    <button onclick="logout()"
                        class="text-left px-4 py-2 text-red-300 hover:bg-indigo-800 rounded">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="flex-1 overflow-hidden relative">

        <!-- Complaints View -->
        <div id="view-complaints" class="w-full h-full overflow-hidden flex flex-col p-4 md:p-6 fade-in">
            <div class="max-w-7xl mx-auto w-full h-full flex flex-col">
                <!-- ================= COMPLAINTS VIEW ================= -->
                <!-- Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6 flex-shrink-0" id="stats-container">
                    <!-- Stats injected here -->
                </div>

                <!-- Toolbar -->
                <div
                    class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4 flex-shrink-0">
                    <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                        <span>üìã</span> Global Registry
                    </h2>
                    <div class="flex flex-wrap gap-2 w-full md:w-auto">
                        <select id="filter-status" onchange="applyFilters()"
                            class="flex-1 md:flex-none bg-white border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 shadow-sm">
                            <option value="all">Status: All</option>
                            <option value="pending">Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="resolved">Resolved</option>
                        </select>
                        <select id="filter-category" onchange="applyFilters()"
                            class="flex-1 md:flex-none bg-white border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 shadow-sm">
                            <option value="all">Category: All</option>
                            <option value="hostel">Hostel</option>
                            <option value="mess">Mess</option>
                            <option value="academic">Academic</option>
                            <option value="security">Security</option>
                        </select>
                        <button onclick="loadData()"
                            class="flex-none bg-indigo-50 text-indigo-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-indigo-100 transition border border-indigo-100">
                            ‚ü≥
                        </button>
                    </div>
                </div>

                <!-- Table -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 flex-1 overflow-hidden flex flex-col">
                    <div class="overflow-x-auto overflow-y-auto flex-1">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-50 sticky top-0 z-10 shadow-sm">
                                <tr>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b">ID / Date</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b">Details</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b">Status</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b">Assigned To</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b text-right">
                                        Action
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="table-body" class="divide-y divide-slate-100 text-sm"></tbody>
                        </table>
                    </div>
                </div>
            </div> <!-- Closing max-w-7xl -->
        </div> <!-- Closing view-complaints (ACTUALLY closing it this time) -->

        <!-- ================= USERS VIEW ================= -->
        <div id="view-users" class="hidden w-full h-full overflow-hidden flex flex-col p-4 md:p-6 fade-in">
            <div class="max-w-7xl mx-auto w-full h-full flex flex-col">
                <!-- Toolbar -->
                <div
                    class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4 flex-shrink-0">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Staff Directory</h2>
                        <p class="text-slate-500 text-sm">Manage Wardens, Supervisors, and permissions.</p>
                    </div>
                    <button onclick="openAddUser()"
                        class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-600/20 transition flex items-center gap-2">
                        <span>+</span> Add New Staff
                    </button>
                </div>

                <!-- User Table -->
                <div
                    class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex-1 overflow-y-auto min-h-0 flex flex-col">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse min-w-[600px]">
                            <thead class="bg-slate-50 sticky top-0 z-10 shadow-sm">
                                <tr>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b">Name & Email
                                    </th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b">Role</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b">Jurisdiction
                                        (Hostel/Dept)</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b text-right">
                                        Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="users-body" class="divide-y divide-slate-100 text-sm">
                                <!-- Loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= STAFF DETAIL VIEW (Hidden by default) ================= -->
        <div id="view-staff-details" class="hidden w-full h-full overflow-hidden flex flex-col p-4 md:p-6 fade-in">
            <div class="max-w-7xl mx-auto w-full h-full flex flex-col">
                <!-- Toolbar -->
                <div class="flex flex-col md:flex-row items-start md:items-center mb-6 gap-4 flex-shrink-0">
                    <button onclick="closeStaffDetails()"
                        class="group flex items-center gap-2 bg-white border border-slate-200 shadow-sm px-4 py-2 rounded-full text-slate-600 hover:text-indigo-600 hover:border-indigo-200 transition font-medium text-sm mb-2 md:mb-0">
                        <span class="group-hover:-translate-x-1 transition-transform">‚Üê</span> Back
                    </button>
                    <div class="md:ml-4">
                        <h2 id="sd-name" class="text-2xl font-bold text-slate-800">Staff Details</h2>
                        <p id="sd-role" class="text-slate-500 text-sm">Role & Jurisdiction</p>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-6 flex-shrink-0">
                    <div class="bg-white p-4 md:p-6 rounded-xl border border-slate-200 shadow-sm">
                        <p class="text-xs font-bold text-slate-400 uppercase">Total Assigned</p>
                        <p id="sd-total" class="text-2xl md:text-3xl font-bold text-indigo-600">0</p>
                    </div>
                    <div class="bg-white p-4 md:p-6 rounded-xl border border-slate-200 shadow-sm">
                        <p class="text-xs font-bold text-slate-400 uppercase">Resolved</p>
                        <p id="sd-resolved" class="text-2xl md:text-3xl font-bold text-green-600">0</p>
                    </div>
                    <div class="bg-white p-4 md:p-6 rounded-xl border border-slate-200 shadow-sm">
                        <p class="text-xs font-bold text-slate-400 uppercase">Pending</p>
                        <p id="sd-pending" class="text-2xl md:text-3xl font-bold text-amber-500">0</p>
                    </div>
                    <div class="bg-white p-4 md:p-6 rounded-xl border border-slate-200 shadow-sm">
                        <p class="text-xs font-bold text-slate-400 uppercase">Resolution Rate</p>
                        <p id="sd-rate" class="text-2xl md:text-3xl font-bold text-blue-500">0%</p>
                    </div>
                </div>

                <h3 class="text-lg font-bold text-slate-800 mb-4 flex-shrink-0">Complaint History</h3>

                <!-- Complaint History Table -->
                <div
                    class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex-1 overflow-y-auto min-h-0 flex flex-col">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse min-w-[600px]">
                            <thead class="bg-slate-50 sticky top-0 z-10 shadow-sm">
                                <tr>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b">Date</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b">Complaint</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b">Status</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase border-b text-right">Notes
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="sd-body" class="divide-y divide-slate-100 text-sm">
                                <!-- Loaded via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- ================= COMPLAINT DETAIL VIEW (Hidden by default) ================= -->
    <div id="view-complaint-details" class="hidden w-full h-full overflow-hidden flex flex-col p-4 md:p-6 fade-in">
        <div class="max-w-4xl mx-auto w-full h-full flex flex-col">
            <!-- Toolbar -->
            <div class="flex flex-col md:flex-row items-start md:items-center mb-6 gap-4 flex-shrink-0">
                <button onclick="closeComplaintDetails()"
                    class="group flex items-center gap-2 bg-white border border-slate-200 shadow-sm px-4 py-2 rounded-full text-slate-600 hover:text-indigo-600 hover:border-indigo-200 transition font-medium text-sm mb-2 md:mb-0">
                    <span class="group-hover:-translate-x-1 transition-transform">‚Üê</span> Back
                </button>
                <div class="md:ml-4">
                    <h2 class="text-2xl font-bold text-slate-800">Complaint Details</h2>
                    <p id="cd-meta" class="text-slate-500 text-sm">ID: #... ‚Ä¢ Date: ...</p>
                </div>
            </div>

            <!-- Content Scrollable -->
            <div
                class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex-1 overflow-y-auto min-h-0">
                <div class="p-8 space-y-8">

                    <!-- Header Status -->
                    <div class="flex justify-between items-start border-b border-slate-100 pb-6">
                        <div>
                            <h1 id="cd-title" class="text-2xl font-bold text-slate-900 mb-2">Title Goes Here</h1>
                            <div class="flex gap-2">
                                <span id="cd-category"
                                    class="px-3 py-1 bg-slate-100 text-slate-600 rounded-full text-xs font-bold uppercase">Category</span>
                                <span id="cd-status"
                                    class="px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-bold uppercase">Pending</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-xs font-bold text-slate-400 uppercase mb-1">Assigned To</p>
                            <p id="cd-assigned" class="font-bold text-indigo-600">Unassigned</p>
                            <button id="cd-assign-btn"
                                class="mt-2 text-xs text-slate-500 hover:text-indigo-600 underline">Change</button>
                        </div>
                    </div>

                    <!-- Student Info -->
                    <div class="grid grid-cols-2 gap-4 bg-slate-50 p-4 rounded-lg">
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase">Student Name</p>
                            <p id="cd-student-name" class="font-bold text-slate-700">Name</p>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase">Hostel / Room</p>
                            <p id="cd-student-hostel" class="font-bold text-slate-700">H1 / 101</p>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase">Email</p>
                            <p id="cd-student-email" class="font-mono text-xs text-slate-600">email@nitmn.ac.in</p>
                        </div>
                    </div>

                    <!-- Description -->
                    <div>
                        <h3 class="text-sm font-bold text-slate-900 uppercase mb-2">Description</h3>
                        <p id="cd-desc" class="text-slate-600 leading-relaxed whitespace-pre-wrap">Description text...
                        </p>
                    </div>

                    <!-- Resolution Notes -->
                    <div id="cd-resolution-section" class="hidden border-t border-slate-100 pt-6">
                        <h3 class="text-sm font-bold text-green-700 uppercase mb-2">‚úÖ Resolution Details</h3>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                            <p id="cd-resolution-notes" class="text-slate-700 italic">Notes...</p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    </div>

    <!-- Modals -->
    <!-- Add/Edit User Modal -->
    <div id="userModal"
        class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 transform scale-100 transition-all">
            <h3 id="modalTitle" class="text-xl font-bold mb-4 text-slate-800">Add New Staff</h3>
            <form id="userForm" class="space-y-4">
                <input type="hidden" id="u-id">

                <div>
                    <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Full Name</label>
                    <input type="text" id="u-name" required
                        class="w-full p-3 border border-slate-200 rounded-lg bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500">
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Email Address</label>
                    <input type="email" id="u-email" required
                        class="w-full p-3 border border-slate-200 rounded-lg bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Role</label>
                        <select id="u-role" onchange="toggleHostelField()"
                            class="w-full p-3 border border-slate-200 rounded-lg bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="warden">Warden</option>
                            <option value="supervisor">Supervisor</option>
                        </select>
                    </div>
                    <div id="hostelField">
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-1"
                            id="jurisdiction-label">Jurisdiction</label>
                        <select id="u-hostel"
                            class="w-full p-3 border border-slate-200 rounded-lg bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                </div>

                <div id="password-group">
                    <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Password</label>
                    <input type="text" id="u-pass" placeholder="Enter new password to reset (Optional)"
                        class="w-full p-3 border border-slate-200 rounded-lg bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500">
                    <p class="text-xs text-slate-400 mt-1" id="pass-hint">Leave empty to keep current. New
                        accounts
                        get
                        auto-generated password via email.</p>
                </div>

                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeUserModal()"
                        class="px-4 py-2 text-slate-500 hover:bg-slate-50 rounded-lg transition">Cancel</button>
                    <button type="submit"
                        class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 font-bold shadow-lg shadow-indigo-600/20">Save
                        Staff</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Re-Assign Modal -->
    <div id="assignModal"
        class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6">
            <h3 class="text-lg font-bold mb-4">Re-Assign Complaint</h3>
            <input type="hidden" id="assignId">
            <div class="mb-6">
                <select id="wardenSelect" class="w-full p-3 border border-slate-200 rounded-lg bg-slate-50"></select>
            </div>
            <div class="flex justify-end gap-3">
                <button onclick="document.getElementById('assignModal').classList.add('hidden')"
                    class="px-4 py-2 text-slate-500">Cancel</button>
                <button onclick="submitAssign()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg">Confirm</button>
            </div>
        </div>
    </div>

    <footer class="bg-slate-950 py-6 text-slate-400 text-sm text-center mt-auto relative z-10">
        <p class="mb-2">Founded: 2010 | Campus: Urban | Director: Dr. D. V. L. N. Somayajulu</p>
        <p>&copy; 2025 NITMN Student Feedback Portal. All rights reserved.</p>
    </footer>

    <script src="../js/config.js"></script>
    <script src="../assets/js/dashboard.js"></script>
    <script src="../assets/js/dashboard.js"></script>
    <script src="../js/admin.js"></script>
</body>

</html>